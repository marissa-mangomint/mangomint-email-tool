<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mangomint Email Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #8B9FED 0%, #C195E8 40%, #F5A6D0 70%, #FFD0B5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.25);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #8B9FED 0%, #C195E8 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 32px; margin-bottom: 8px; }
        .header p { opacity: 0.95; font-size: 15px; }
        
        .mango-emoji {
            font-size: 40px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .content { padding: 35px; }
        
        .ai-status {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .ai-status h3 { color: #92400e; font-size: 16px; margin-bottom: 10px; }
        .ai-status p { color: #78350f; font-size: 13px; }
        
        .ai-status.ready {
            background: #f0fdf4;
            border-color: #86efac;
        }
        
        .ai-status.ready h3 { color: #16a34a; }
        .ai-status.ready p { color: #15803d; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            transition: width 0.3s;
            width: 0%;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(146, 64, 14, 0.2);
            border-top-color: #92400e;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .form-section { margin-bottom: 25px; }
        
        .form-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        .form-section input,
        .form-section select,
        .form-section textarea {
            width: 100%;
            padding: 13px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        .form-section input:focus,
        .form-section select:focus,
        .form-section textarea:focus {
            outline: none;
            border-color: #E54B97;
            box-shadow: 0 0 0 3px rgba(229, 75, 151, 0.1);
        }
        
        .form-section textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .two-col { grid-template-columns: 1fr; }
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-extract {
            width: 100%;
            background: #6366f1;
            color: white;
            margin-top: 10px;
        }
        
        .btn-extract:hover:not(:disabled) {
            background: #4f46e5;
            transform: translateY(-2px);
        }
        
        .btn-extract:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-generate {
            width: 100%;
            background: linear-gradient(135deg, #E54B97 0%, #D43D8A 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(229, 75, 151, 0.3);
            margin-top: 10px;
        }
        
        .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(229, 75, 151, 0.4);
        }
        
        .btn-copy {
            background: #10b981;
            color: white;
        }
        
        .btn-copy:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .btn-copy.copied {
            background: #6366f1;
        }
        
        .extracted-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .extracted-box.show { display: block; }
        
        .extracted-box h4 {
            color: #16a34a;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .extracted-item {
            font-size: 13px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .output-container {
            margin-top: 30px;
            display: none;
        }
        
        .output-container.show { display: block; }
        
        .copy-box {
            background: #fef8f4;
            border: 2px solid #ffe8dc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .copy-box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .copy-box-header h3 {
            color: #333;
            font-size: 16px;
        }
        
        .copy-box-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
            font-size: 14px;
            color: #333;
            min-height: 50px;
        }
        
        .email-body {
            white-space: pre-wrap;
            line-height: 1.7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="mango-emoji">ü•≠</span> Email Generator</h1>
            <p>AI-assisted ‚Ä¢ Auto-linked ‚Ä¢ Production ready</p>
        </div>
        
        <div class="content">
            <div id="aiStatus" class="ai-status">
                <div class="loading-spinner"></div>
                <h3>Loading AI...</h3>
                <p>One-time download (~50MB). Extracts customer name & launch date.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText" style="margin-top: 10px; font-size: 12px;">Initializing...</p>
            </div>
            
            <div class="two-col">
                <div class="form-section">
                    <label for="omName">Your Name</label>
                    <input type="text" id="omName" placeholder="e.g., Ryan Keefe">
                    <div class="help-text">Saved and remembered</div>
                </div>
                
                <div class="form-section">
                    <label for="companyName">Company Name</label>
                    <input type="text" id="companyName" placeholder="e.g., Luxe Salon & Spa">
                    <div class="help-text">Manual entry (you know this from the call)</div>
                </div>
            </div>
            
            <div class="form-section">
                <label for="transcript">üìã Paste Transcript (Optional)</label>
                <textarea id="transcript" placeholder="Paste transcript to auto-extract customer name & launch date...

Or skip and fill manually below."></textarea>
                <button type="button" class="btn btn-extract" id="extractBtn" onclick="extractBasics()" disabled>
                    <span class="loading-spinner" style="display: none;" id="extractSpinner"></span>
                    <span id="extractBtnText">ü§ñ Quick Extract (Name & Date)</span>
                </button>
            </div>
            
            <div id="extractedInfo" class="extracted-box">
                <h4>‚úì Extracted:</h4>
                <div class="extracted-item"><strong>Customer:</strong> <span id="displayCustomer"></span></div>
                <div class="extracted-item"><strong>Launch Date:</strong> <span id="displayLaunchDate"></span></div>
            </div>
            
            <div class="two-col">
                <div class="form-section">
                    <label for="customerFirstName">Customer First Name</label>
                    <input type="text" id="customerFirstName" placeholder="e.g., Georgia">
                    <div class="help-text">Auto-filled or manual entry</div>
                </div>
                
                <div class="form-section">
                    <label for="launchDate">Launch Date</label>
                    <input type="text" id="launchDate" placeholder="e.g., March 2nd">
                    <div class="help-text">Auto-filled or manual entry</div>
                </div>
            </div>
            
            <div class="form-section">
                <label for="emailTemplate">Email Template</label>
                <select id="emailTemplate">
                    <option value="followup1">Follow-up | OB Call 1</option>
                    <option value="followup2">Follow-up | OB Call 2</option>
                    <option value="call1_scheduled">OB Call 1 Scheduled</option>
                    <option value="missed_launch">Missed Launch Date</option>
                    <option value="kickoff">Kickoff Meeting</option>
                    <option value="training">Training Reminder</option>
                    <option value="data_request">Data Request</option>
                </select>
            </div>
            
            <div class="form-section">
                <label for="actionItems">Action Items (One per line)</label>
                <textarea id="actionItems" placeholder="Add action items from your call notes:

Ryan will import staff members by Feb 26th
Complete your service menu
Set up payment processing
Order front desk equipment"></textarea>
                <div class="help-text">Links to Learn Center will be added automatically!</div>
            </div>
            
            <button class="btn btn-generate" onclick="generateEmail()">‚ú® Generate Email</button>
            
            <div class="output-container" id="outputContainer">
                <div class="copy-box">
                    <div class="copy-box-header">
                        <h3>Subject Line:</h3>
                        <button class="btn btn-copy" onclick="copySubject()">Copy Subject</button>
                    </div>
                    <div class="copy-box-content" id="subjectOutput"></div>
                </div>
                
                <div class="copy-box">
                    <div class="copy-box-header">
                        <h3>Email Body:</h3>
                        <button class="btn btn-copy" onclick="copyBody()">Copy Email</button>
                    </div>
                    <div class="copy-box-content email-body" id="bodyOutput"></div>
                </div>
                
                <p style="font-size: 13px; color: #666; text-align: center; margin-top: 15px;">
                    üìß In Superhuman: <strong>Shift+C</strong> ‚Üí Paste subject ‚Üí Paste body ‚Üí Send
                </p>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";
        
        let engine = null;
        let isAIReady = false;
        
        async function initAI() {
            const statusEl = document.getElementById('aiStatus');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const extractBtn = document.getElementById('extractBtn');
            
            try {
                engine = await CreateMLCEngine("Phi-3.5-mini-instruct-q4f16_1-MLC", {
                    initProgressCallback: (progress) => {
                        if (progress.progress) {
                            const percent = Math.round(progress.progress * 100);
                            progressFill.style.width = percent + '%';
                            progressText.textContent = `${percent}%`;
                        }
                    }
                });
                
                isAIReady = true;
                statusEl.className = 'ai-status ready';
                statusEl.innerHTML = '<h3>‚úÖ AI Ready</h3><p>Paste transcript for quick name/date extraction.</p>';
                extractBtn.disabled = false;
                
            } catch (error) {
                console.error('AI init error:', error);
                statusEl.className = 'ai-status';
                statusEl.style.background = '#fef2f2';
                statusEl.style.borderColor = '#fca5a5';
                statusEl.innerHTML = '<h3 style="color: #991b1b;">‚ö†Ô∏è AI requires hosting</h3><p style="color: #7f1d1d;">Upload to GitHub Pages. Fill fields manually for now.</p>';
                extractBtn.disabled = true;
            }
        }
        
        window.extractBasics = async function() {
            const transcript = document.getElementById('transcript').value;
            const extractBtn = document.getElementById('extractBtn');
            const btnText = document.getElementById('extractBtnText');
            const spinner = document.getElementById('extractSpinner');
            
            if (!transcript) {
                alert('Paste a transcript first, or skip and fill fields manually.');
                return;
            }
            
            if (!isAIReady) {
                alert('AI still loading. Fill manually for now.');
                return;
            }
            
            try {
                extractBtn.disabled = true;
                spinner.style.display = 'inline-block';
                btnText.textContent = 'Extracting...';
                
                // Short prompt - just name and date
                const prompt = `Extract from transcript as JSON:

{
  "customerFirstName": "first name only",
  "launchDate": "date like 'March 2nd' or null"
}

Transcript (first 8000 chars):
${transcript.slice(0, 8000)}

JSON only:`;

                const response = await engine.chat.completions.create({
                    messages: [{ role: "user", content: prompt }],
                    temperature: 0.1,
                    max_tokens: 200,
                });
                
                const content = response.choices[0].message.content;
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                
                if (!jsonMatch) throw new Error('No JSON');
                
                const extracted = JSON.parse(jsonMatch[0]);
                
                document.getElementById('customerFirstName').value = extracted.customerFirstName || '';
                document.getElementById('launchDate').value = extracted.launchDate || '';
                
                document.getElementById('displayCustomer').textContent = extracted.customerFirstName || 'Not found';
                document.getElementById('displayLaunchDate').textContent = extracted.launchDate || 'Not mentioned';
                
                document.getElementById('extractedInfo').classList.add('show');
                
                alert('‚úÖ Extracted! Now add company name & action items below.');
                document.getElementById('companyName').focus();
                
            } catch (error) {
                alert(`Extraction failed: ${error.message}\n\nNo problem - just fill the fields manually!`);
            } finally {
                extractBtn.disabled = false;
                spinner.style.display = 'none';
                btnText.textContent = 'ü§ñ Quick Extract (Name & Date)';
            }
        };
        
        initAI();
    </script>
    
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('omName');
            if (saved) document.getElementById('omName').value = saved;
        });
        
        document.getElementById('omName').addEventListener('change', (e) => {
            localStorage.setItem('omName', e.target.value);
        });
        
        const learnMap = {
            'staff': 'https://www.mangomint.com/learn/adding-a-staff-member/',
            'payment': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'mangomint pay': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'front desk': 'https://www.mangomint.com/learn/setting-up-your-front-desk-display/',
            'equipment': 'https://www.mangomint.com/learn/setting-up-your-front-desk-display/',
            'website': 'https://www.mangomint.com/learn/adding-online-booking-to-your-website/',
            'online booking': 'https://www.mangomint.com/learn/adding-online-booking-to-your-website/',
        };
        
        function formatTasks(text) {
            if (!text) return '';
            
            const lines = text.split('\n').filter(l => l.trim());
            
            return lines.map(line => {
                let task = line.trim();
                
                // Remove bullet if already there
                task = task.replace(/^[‚Ä¢\-\*]\s*/, '');
                
                const lower = task.toLowerCase();
                let link = null;
                for (const [kw, url] of Object.entries(learnMap)) {
                    if (lower.includes(kw)) {
                        link = url;
                        break;
                    }
                }
                
                return link ? `‚Ä¢ ${task}\n  ${link}` : `‚Ä¢ ${task}`;
            }).join('\n\n');
        }
        
        function generateEmail() {
            const tmpl = document.getElementById('emailTemplate').value;
            const first = document.getElementById('customerFirstName').value || '[Name]';
            const co = document.getElementById('companyName').value || '[Company]';
            const date = document.getElementById('launchDate').value || '[launch date]';
            const om = document.getElementById('omName').value || '[Your Name]';
            const tasks = formatTasks(document.getElementById('actionItems').value);
            
            let subj = '', body = '';
            
            switch(tmpl) {
                case 'followup1':
                    subj = `Call Recap | ${co} x Mangomint`;
                    body = `Hi ${first},

Thanks for your time this afternoon. It was great to chat with you!

Please refer to your Get Started page to keep you on track for your ${date} launch date. Please check tasks off as you go so I can track your progress.

Here are some next steps to complete before our next call:

${tasks || '‚Ä¢ [Add tasks]'}

Reach out if you need anything! ü•≠

${om}`;
                    break;
                    
                case 'followup2':
                    subj = `You're almost there üöÄ | ${co} x Mangomint`;
                    body = `Hi ${first}!

It was so good to connect with you today!

You're still right on track for your ${date} launch date. Please check your tasks off as you go so I can track your progress.

Here are some tasks to complete before our next call:

${tasks || '‚Ä¢ [Add tasks]'}

I'll see you soon. Email or text if you have any questions!

${om}`;
                    break;
                    
                case 'call1_scheduled':
                    subj = `Your Onboarding Session | ${co} x Mangomint`;
                    body = `Hi ${first}!

Thank you for booking your onboarding session! I can't wait to chat with you.
When it's time, simply hop on your computer and join me in the meeting room in your calendar invite.

During our call, we'll start piecing everything together to kickstart your journey with Mangomint. We'll cover everything from transferring your data to setting up payments & POS, and of course, I'll be here to answer any questions you may have.

Need anything before our meeting? Just drop me a line and I'll be happy to help! üòé

Excited to chat soon!

${om}`;
                    break;
                    
                case 'missed_launch':
                    subj = `üîí Let's lock in a new launch date`;
                    body = `Hey there,

Looks like our original launch date didn't quite stick ‚Äì no worries! Let's set a new one and realign on the remaining tasks.

Here's what's left to wrap up:

${tasks || '‚Ä¢ [List tasks]'}

Let me know your thoughts on a new date or any updates, and we'll keep things moving forward.

Best,
${om}`;
                    break;
                    
                case 'kickoff':
                    subj = `Kickoff Call Scheduled | ${co} x Mangomint`;
                    body = `Hi ${first},

I'm excited to confirm our kickoff meeting for ${co}!

During this call, we'll walk through your Mangomint account setup, discuss your business processes, review your ${date} launch timeline, and answer any questions.

To make the most of our time, please have ready:
‚Ä¢ Your current booking/scheduling process
‚Ä¢ List of services you offer
‚Ä¢ Staff member names and roles

If this time doesn't work, just let me know!

Looking forward to it! ü•≠

${om}`;
                    break;
                    
                case 'training':
                    subj = `Training Session Reminder | ${co} x Mangomint`;
                    body = `Hi ${first},

Friendly reminder about your training session for ${co}!

We'll cover calendar management, processing payments, client features, and best practices. Please have your team join - the more people attend, the smoother your ${date} launch!

See you soon! ü•≠

${om}`;
                    break;
                    
                case 'data_request':
                    subj = `Data Collection | ${co} x Mangomint`;
                    body = `Hi ${first},

As we prepare for your ${date} launch, I need to collect some information:

${tasks || '‚Ä¢ Client list (names, contact info)\n‚Ä¢ Service menu with pricing\n‚Ä¢ Staff schedules'}

Send in whatever format works best - spreadsheet, CSV, or your current system export.

The sooner I have this, the faster we can get you live!

Thanks! ü•≠

${om}`;
                    break;
            }
            
            document.getElementById('subjectOutput').textContent = subj;
            document.getElementById('bodyOutput').textContent = body;
            document.getElementById('outputContainer').classList.add('show');
            document.getElementById('outputContainer').scrollIntoView({ behavior: 'smooth' });
            
            window.currentSubject = subj;
            window.currentBody = body;
        }
        
        function copySubject() {
            navigator.clipboard.writeText(window.currentSubject).then(() => {
                const btns = document.querySelectorAll('.btn-copy');
                btns[0].textContent = '‚úì Copied!';
                btns[0].classList.add('copied');
                setTimeout(() => {
                    btns[0].textContent = 'Copy Subject';
                    btns[0].classList.remove('copied');
                }, 2000);
            });
        }
        
        function copyBody() {
            navigator.clipboard.writeText(window.currentBody).then(() => {
                const btns = document.querySelectorAll('.btn-copy');
                btns[1].textContent = '‚úì Copied!';
                btns[1].classList.add('copied');
                setTimeout(() => {
                    btns[1].textContent = 'Copy Email';
                    btns[1].classList.remove('copied');
                }, 2000);
            });
        }
    </script>
</body>
</html>