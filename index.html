<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mangomint Email Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #8B9FED 0%, #C195E8 40%, #F5A6D0 70%, #FFD0B5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.25);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #8B9FED 0%, #C195E8 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 32px; margin-bottom: 8px; }
        .header p { opacity: 0.95; font-size: 15px; }
        
        .mango-emoji {
            font-size: 40px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .content { padding: 35px; }
        
        .ai-status {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .ai-status h3 { color: #92400e; font-size: 16px; margin-bottom: 6px; }
        .ai-status p { color: #78350f; font-size: 13px; }
        
        .ai-status.ready { background: #f0fdf4; border-color: #86efac; }
        .ai-status.ready h3 { color: #16a34a; }
        .ai-status.ready p { color: #15803d; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            transition: width 0.3s;
            width: 0%;
        }
        
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(146,64,14,0.2);
            border-top-color: #92400e;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .spinner.white {
            border-color: rgba(255,255,255,0.3);
            border-top-color: white;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .form-section { margin-bottom: 25px; }
        
        .form-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        .form-section input,
        .form-section select,
        .form-section textarea {
            width: 100%;
            padding: 13px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        .form-section input:focus,
        .form-section select:focus,
        .form-section textarea:focus {
            outline: none;
            border-color: #E54B97;
            box-shadow: 0 0 0 3px rgba(229,75,151,0.1);
        }
        
        .form-section textarea {
            min-height: 140px;
            resize: vertical;
        }
        
        .help-text { font-size: 12px; color: #666; margin-top: 5px; }
        
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) { .two-col { grid-template-columns: 1fr; } }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-extract {
            width: 100%;
            background: #6366f1;
            color: white;
            margin-top: 10px;
        }
        
        .btn-extract:hover:not(:disabled) { background: #4f46e5; transform: translateY(-2px); }
        .btn-extract:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .btn-generate {
            width: 100%;
            background: linear-gradient(135deg, #E54B97 0%, #D43D8A 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(229,75,151,0.3);
            margin-top: 10px;
        }
        
        .btn-generate:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(229,75,151,0.4); }
        
        .btn-copy { background: #10b981; color: white; }
        .btn-copy:hover { background: #059669; transform: translateY(-2px); }
        .btn-copy.copied { background: #6366f1; }
        
        .extracted-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }
        
        .extracted-box.show { display: block; }
        
        .extracted-box h4 { color: #16a34a; font-size: 15px; margin-bottom: 12px; }
        
        .extracted-field {
            margin-bottom: 10px;
        }
        
        .extracted-field label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: block;
            margin-bottom: 4px;
        }
        
        .extracted-field input,
        .extracted-field textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #86efac;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: white;
        }
        
        .extracted-field input:focus,
        .extracted-field textarea:focus {
            outline: none;
            border-color: #E54B97;
            box-shadow: 0 0 0 3px rgba(229,75,151,0.1);
        }
        
        .extracted-field textarea { min-height: 120px; resize: vertical; }
        
        .output-container { margin-top: 30px; display: none; }
        .output-container.show { display: block; }
        
        .copy-box {
            background: #fef8f4;
            border: 2px solid #ffe8dc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .copy-box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .copy-box-header h3 { color: #333; font-size: 16px; }
        
        .copy-box-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
            font-size: 14px;
            color: #333;
            min-height: 50px;
            white-space: pre-wrap;
            line-height: 1.7;
        }

        .divider {
            border: none;
            border-top: 2px solid #f0f0f0;
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="mango-emoji">ü•≠</span> Email Generator</h1>
            <p>Paste Momentum summary ‚Üí AI extracts everything ‚Üí Send in seconds</p>
        </div>
        
        <div class="content">

            <!-- AI Status -->
            <div id="aiStatus" class="ai-status">
                <div class="spinner"></div>
                <h3>Loading AI...</h3>
                <p>First time: ~2 min download. After that: instant forever.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText" style="margin-top: 8px; font-size: 12px;">Initializing...</p>
            </div>

            <!-- Step 1: Your name + Company -->
            <div class="two-col">
                <div class="form-section">
                    <label for="omName">Your Name</label>
                    <input type="text" id="omName" placeholder="e.g., Amie Hough">
                    <div class="help-text">Saved automatically</div>
                </div>
                <div class="form-section">
                    <label for="companyName">Company Name</label>
                    <input type="text" id="companyName" placeholder="e.g., Luxe Salon & Spa">
                    <div class="help-text">Fill in or AI will extract if mentioned</div>
                </div>
            </div>

            <!-- Step 2: Paste Momentum Summary -->
            <div class="form-section">
                <label for="summary">üìã Paste Momentum Call Summary</label>
                <textarea id="summary" placeholder="Paste the Momentum AI summary here (not the full transcript)...

AI will extract:
‚úì Customer name
‚úì Launch date  
‚úì Action items with owners (OM vs Customer)
‚úì Due dates if mentioned"></textarea>
                <button type="button" class="btn btn-extract" id="extractBtn" onclick="extractFromSummary()" disabled>
                    <span class="spinner white" style="display:none;" id="extractSpinner"></span>
                    <span id="extractBtnText">ü§ñ Extract from Summary</span>
                </button>
            </div>

            <!-- Extracted Results (Editable) -->
            <div id="extractedBox" class="extracted-box">
                <h4>‚úì Extracted ‚Äî Review & Edit:</h4>
                
                <div class="two-col">
                    <div class="extracted-field">
                        <label>Customer First Name</label>
                        <input type="text" id="customerFirstName" placeholder="First name">
                    </div>
                    <div class="extracted-field">
                        <label>Launch Date</label>
                        <input type="text" id="launchDate" placeholder="e.g., March 2nd">
                    </div>
                </div>
                
                <div class="extracted-field" style="margin-top: 10px;">
                    <label>Action Items (one per line ‚Äî edit freely)</label>
                    <textarea id="actionItems" placeholder="Action items will appear here..."></textarea>
                    <div class="help-text">Learn Center links added automatically on generate!</div>
                </div>
            </div>

            <hr class="divider">

            <!-- Step 3: Template -->
            <div class="form-section">
                <label for="emailTemplate">Email Template</label>
                <select id="emailTemplate">
                    <option value="followup1">Follow-up | OB Call 1</option>
                    <option value="followup2">Follow-up | OB Call 2</option>
                    <option value="call1_scheduled">OB Call 1 Scheduled</option>
                    <option value="missed_launch">Missed Launch Date</option>
                    <option value="kickoff">Kickoff Meeting</option>
                    <option value="training">Training Reminder</option>
                    <option value="data_request">Data Request</option>
                </select>
            </div>

            <button class="btn btn-generate" onclick="generateEmail()">‚ú® Generate Email</button>

            <!-- Output -->
            <div class="output-container" id="outputContainer">
                <div class="copy-box">
                    <div class="copy-box-header">
                        <h3>Subject Line</h3>
                        <button class="btn btn-copy" id="copySubjectBtn" onclick="copySubject()">Copy Subject</button>
                    </div>
                    <div class="copy-box-content" id="subjectOutput"></div>
                </div>
                
                <div class="copy-box">
                    <div class="copy-box-header">
                        <h3>Email Body</h3>
                        <button class="btn btn-copy" id="copyBodyBtn" onclick="copyBody()">Copy Email</button>
                    </div>
                    <div class="copy-box-content" id="bodyOutput"></div>
                </div>
                
                <p style="font-size: 13px; color: #888; text-align: center; margin-top: 10px;">
                    üìß Superhuman: <strong>Shift+C</strong> ‚Üí paste subject ‚Üí paste body ‚Üí send
                </p>
            </div>

        </div>
    </div>

    <script type="module">
        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";
        
        let engine = null;
        let isAIReady = false;
        
        async function initAI() {
            const statusEl = document.getElementById('aiStatus');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const extractBtn = document.getElementById('extractBtn');
            
            try {
                engine = await CreateMLCEngine("Phi-3.5-mini-instruct-q4f16_1-MLC", {
                    initProgressCallback: (progress) => {
                        if (progress.progress) {
                            const pct = Math.round(progress.progress * 100);
                            progressFill.style.width = pct + '%';
                            progressText.textContent = `${pct}% loaded`;
                        }
                    }
                });
                
                isAIReady = true;
                statusEl.className = 'ai-status ready';
                statusEl.innerHTML = '<h3>‚úÖ AI Ready</h3><p>Paste your Momentum summary and click Extract.</p>';
                extractBtn.disabled = false;
                
            } catch (err) {
                console.error(err);
                statusEl.style.background = '#fef2f2';
                statusEl.style.borderColor = '#fca5a5';
                statusEl.innerHTML = '<h3 style="color:#991b1b;">‚ö†Ô∏è Requires hosting on GitHub Pages</h3><p style="color:#7f1d1d;">Fill fields manually below.</p>';
            }
        }
        
        window.extractFromSummary = async function() {
            const summary = document.getElementById('summary').value.trim();
            const btn = document.getElementById('extractBtn');
            const btnText = document.getElementById('extractBtnText');
            const spinner = document.getElementById('extractSpinner');
            
            if (!summary) { alert('Please paste a Momentum summary first.'); return; }
            if (!isAIReady) { alert('AI still loading...'); return; }
            
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            btnText.textContent = 'Extracting...';
            
            const omName = document.getElementById('omName').value || 'I';

            const prompt = `Extract from this Mangomint onboarding call summary. Return ONLY valid JSON:

{
  "customerFirstName": "first name only",
  "companyName": "business name or null",
  "launchDate": "e.g. March 2nd or null",
  "customerTasks": [
    "Customer first name will [specific task]"
  ],
  "omResources": [
    "Here is how you can [topic] ‚Äî [brief description]"
  ]
}

Rules:
- customerTasks: ONLY tasks the CUSTOMER must do. Start each with their first name + "will"
- omResources: Things the OM said they would send or share. Convert to "Here is how you can [do X]" format. Max 2.
- Never put OM tasks in customerTasks
- Never put customer tasks in omResources
- Be specific, include context
- Max 6 customer tasks, max 2 OM resources
- No bullets or dashes in text

Summary:
${summary}

JSON only:`;

            try {
                const response = await engine.chat.completions.create({
                    messages: [{ role: "user", content: prompt }],
                    temperature: 0.1,
                    max_tokens: 600,
                });
                
                const content = response.choices[0].message.content;
                const match = content.match(/\{[\s\S]*\}/);
                if (!match) throw new Error('Could not parse response');
                
                const data = JSON.parse(match[0]);
                
                document.getElementById('customerFirstName').value = data.customerFirstName || '';
                document.getElementById('launchDate').value = data.launchDate || '';
                
                if (data.companyName && !document.getElementById('companyName').value) {
                    document.getElementById('companyName').value = data.companyName;
                }
                
                // Combine customer tasks + OM resources into action items field
                const allItems = [];
                if (data.customerTasks?.length > 0) {
                    data.customerTasks.forEach(t => allItems.push(t));
                }
                if (data.omResources?.length > 0) {
                    allItems.push('---');
                    data.omResources.forEach(r => allItems.push(r));
                }
                
                if (allItems.length > 0) {
                    document.getElementById('actionItems').value = allItems.join('\n');
                }
                
                document.getElementById('extractedBox').classList.add('show');
                document.getElementById('extractedBox').scrollIntoView({ behavior: 'smooth' });
                
            } catch (err) {
                alert(`Extraction failed: ${err.message}\n\nFill the fields manually below.`);
                document.getElementById('extractedBox').classList.add('show');
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                btnText.textContent = 'ü§ñ Extract from Summary';
            }
        };
        
        initAI();
    </script>

    <script>
        // Updated Learn Center map with correct URLs
        const learnMap = {
            'staff': 'https://www.mangomint.com/learn/adding-a-staff-member/',
            'invite': 'https://www.mangomint.com/learn/adding-a-staff-member/',
            'payment processing': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'mangomint pay': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'stripe': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'payment account': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'bank account': 'https://www.mangomint.com/learn/signing-up-for-payment-processing/',
            'front desk': 'https://www.mangomint.com/learn/setting-up-your-front-desk-display/',
            'ipad': 'https://www.mangomint.com/learn/setting-up-your-front-desk-display/',
            'equipment': 'https://www.mangomint.com/learn/setting-up-your-front-desk-display/',
            'card reader': 'https://www.mangomint.com/learn/setting-up-your-front-desk-display/',
            'website': 'https://www.mangomint.com/learn/adding-online-booking-to-your-website/',
            'online booking': 'https://www.mangomint.com/learn/adding-online-booking-to-your-website/',
            'booking overlay': 'https://www.mangomint.com/learn/adding-online-booking-to-your-website/',
            'import': 'https://www.mangomint.com/learn/importing-clients/',
            'client list': 'https://www.mangomint.com/learn/importing-clients/',
            'booth renter': 'https://www.mangomint.com/learn/booth-renters/',
            'booth': 'https://www.mangomint.com/learn/booth-renters/',
            'membership': 'https://www.mangomint.com/learn/memberships/',
            'gift card': 'https://www.mangomint.com/learn/gift-cards/',
            'calendar': 'https://www.mangomint.com/learn/calendar-settings/',
            'services': 'https://www.mangomint.com/learn/services/',
            'service menu': 'https://www.mangomint.com/learn/services/',
            'forms': 'https://www.mangomint.com/learn/forms/',
            'intake form': 'https://www.mangomint.com/learn/forms/',
            'messaging': 'https://www.mangomint.com/learn/automated-messages/',
            'reminders': 'https://www.mangomint.com/learn/automated-messages/',
            'automated messages': 'https://www.mangomint.com/learn/automated-messages/',
            'client messaging': 'https://www.mangomint.com/learn/automated-messages/',
        };

        function formatTasks(text) {
            if (!text) return '';
            
            const customerFirst = document.getElementById('customerFirstName').value || '';
            const lines = text.split('\n').map(l => l.trim()).filter(l => l && !l.toLowerCase().includes('add task'));
            
            const separatorIndex = lines.indexOf('---');
            const customerLines = separatorIndex >= 0 ? lines.slice(0, separatorIndex) : lines;
            const resourceLines = separatorIndex >= 0 ? lines.slice(separatorIndex + 1) : [];
            
            const formatLine = (line, isResource = false) => {
                line = line.replace(/^[‚Ä¢\-\*\d\.]+\s*/, '');
                
                // Remove customer name from start of task ("Bob will " ‚Üí "")
                if (customerFirst) {
                    const namePatterns = [
                        new RegExp(`^${customerFirst}\\s+will\\s+`, 'i'),
                        new RegExp(`^${customerFirst}\\s+to\\s+`, 'i'),
                        new RegExp(`^${customerFirst}\\s+needs\\s+to\\s+`, 'i'),
                    ];
                    for (const pattern of namePatterns) {
                        if (pattern.test(line)) {
                            line = line.replace(pattern, '');
                            // Capitalize first letter
                            line = line.charAt(0).toUpperCase() + line.slice(1);
                            break;
                        }
                    }
                }
                
                const lower = line.toLowerCase();
                let link = null;
                for (const [kw, url] of Object.entries(learnMap)) {
                    if (lower.includes(kw)) { link = url; break; }
                }
                return link ? `‚Ä¢ ${line} ‚Äî ${link}` : `‚Ä¢ ${line}`;
            };
            
            const customerFormatted = customerLines.map(l => formatLine(l)).join('\n');
            const resourceFormatted = resourceLines.map(l => formatLine(l, true)).join('\n');
            
            if (resourceFormatted) {
                return customerFormatted + '\n' + resourceFormatted;
            }
            return customerFormatted;
        }
        
        // Save OM name
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('omName');
            if (saved) document.getElementById('omName').value = saved;
        });
        
        document.getElementById('omName').addEventListener('change', e => {
            localStorage.setItem('omName', e.target.value);
        });

        function generateEmail() {
            const tmpl = document.getElementById('emailTemplate').value;
            const first = document.getElementById('customerFirstName').value || '[Name]';
            const co = document.getElementById('companyName').value || '[Company]';
            const date = document.getElementById('launchDate').value || '[launch date]';
            const om = document.getElementById('omName').value || '[Your Name]';
            const tasks = formatTasks(document.getElementById('actionItems').value);

            let subj = '', body = '';

            switch(tmpl) {
                case 'followup1':
                    subj = `Call Recap | ${co} x Mangomint`;
                    body = `Hi ${first},

Thanks for your time this afternoon. It was great to chat with you!

Please refer to your Get Started page to keep you on track for your ${date} launch date. Please check tasks off as you go so I can track your progress.

Here are your next steps before our next call:

${tasks || '‚Ä¢ [Add tasks]'}

Reach out if you need anything! ü•≠

${om}`;
                    break;

                case 'followup2':
                    subj = `You're almost there üöÄ | ${co} x Mangomint`;
                    body = `Hi ${first}!

It was so good to connect with you today!

You're still right on track for your ${date} launch date. Please check your tasks off as you go so I can track your progress.

Here are your tasks before our next call:

${tasks || '‚Ä¢ [Add tasks]'}

I'll see you soon. Email or text if you have any questions!

${om}`;
                    break;

                case 'call1_scheduled':
                    subj = `Your Onboarding Session | ${co} x Mangomint`;
                    body = `Hi ${first}!

Thank you for booking your onboarding session! I can't wait to chat with you.

When it's time, simply hop on your computer and join me in the meeting room in your calendar invite.

During our call, we'll start piecing everything together to kickstart your journey with Mangomint. We'll cover everything from transferring your data to setting up payments & POS, and of course, I'll be here to answer any questions you may have.

Need anything before our meeting? Just drop me a line! üòé

Excited to chat soon!

${om}`;
                    break;

                case 'missed_launch':
                    subj = `üîí Let's lock in a new launch date`;
                    body = `Hey there,

Looks like our original launch date didn't quite stick ‚Äì no worries! Let's set a new one and realign on the remaining tasks.

Here's what's left to wrap up:

${tasks || '‚Ä¢ [List tasks]'}

Let me know your thoughts on a new date and we'll keep things moving forward.

Best,
${om}`;
                    break;

                case 'kickoff':
                    subj = `Kickoff Call Scheduled | ${co} x Mangomint`;
                    body = `Hi ${first},

I'm excited to confirm our kickoff meeting for ${co}!

During this call, we'll walk through your Mangomint account setup, discuss your business processes, review your ${date} launch timeline, and answer any questions.

To make the most of our time, please have ready:
‚Ä¢ Your current booking/scheduling process
‚Ä¢ List of services you offer
‚Ä¢ Staff member names and roles

If this time doesn't work, just let me know!

Looking forward to it! ü•≠

${om}`;
                    break;

                case 'training':
                    subj = `Training Session Reminder | ${co} x Mangomint`;
                    body = `Hi ${first},

Friendly reminder about your training session for ${co}!

We'll cover calendar management, processing payments, client features, and best practices. Please have your team join - the more people attend, the smoother your ${date} launch!

See you soon! ü•≠

${om}`;
                    break;

                case 'data_request':
                    subj = `Data Collection | ${co} x Mangomint`;
                    body = `Hi ${first},

As we prepare for your ${date} launch, I need to collect some information:

${tasks || '‚Ä¢ Client list (names, contact info)\n‚Ä¢ Service menu with pricing\n‚Ä¢ Staff schedules'}

Send in whatever format works best - spreadsheet, CSV, or your current system export.

The sooner I have this, the faster we can get you live!

Thanks! ü•≠

${om}`;
                    break;
            }

            window.currentSubject = subj;
            window.currentBody = body;

            document.getElementById('subjectOutput').textContent = subj;
            document.getElementById('bodyOutput').textContent = body;
            document.getElementById('outputContainer').classList.add('show');
            document.getElementById('outputContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function copySubject() {
            navigator.clipboard.writeText(window.currentSubject).then(() => {
                const btn = document.getElementById('copySubjectBtn');
                btn.textContent = '‚úì Copied!';
                btn.classList.add('copied');
                setTimeout(() => { btn.textContent = 'Copy Subject'; btn.classList.remove('copied'); }, 2000);
            });
        }

        function copyBody() {
            navigator.clipboard.writeText(window.currentBody).then(() => {
                const btn = document.getElementById('copyBodyBtn');
                btn.textContent = '‚úì Copied!';
                btn.classList.add('copied');
                setTimeout(() => { btn.textContent = 'Copy Email'; btn.classList.remove('copied'); }, 2000);
            });
        }
    </script>
</body>
</html>